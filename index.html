<!doctype html>
<html lang="de" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pendler Dashboard</title>

<!-- Homescreen/Browser-Icons -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<link rel="alternate icon" type="image/png" sizes="512x512" href="apple-touch-icon.png">

<!-- Font Awesome Free -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.2/css/all.min.css">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Pendler Dashboard">

<style>
  :root{
    --accent:#ec0016; --bg:#f8f9fb; --panel:#ffffff; --text:#181c22; --muted:#667486;
    --rule:#e5eaf0; --chip:#f3f6f9; --shadow:0 0 0 1px rgba(0,0,0,.02), 0 10px 30px rgba(0,0,0,.08);
    --font: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }
  [data-theme="dark"]{ --bg:#0b0f14; --panel:#0f1620; --text:#eaf2ff; --muted:#9aa8bd; --rule:#16202c; --chip:#111c28; --shadow:none; }
  html,body{height:100%}
  body{margin:0; background:var(--bg); color:var(--text); font-family:var(--font); -webkit-font-smoothing:antialiased;}

  /* Header + Tabs */
  .hdr{position:sticky; top:0; z-index:40; display:flex; align-items:center; gap:16px; padding:16px 20px; background:var(--panel); border-bottom:1px solid var(--rule); box-shadow:var(--shadow);}
  .brand{ font-weight:800; letter-spacing:.2px; font-size:22px; }
  .spacer{flex:1}
  .iconbtn{ border:1px solid var(--rule); background:var(--chip); color:var(--text); border-radius:12px; padding:10px 12px; display:inline-flex; align-items:center; gap:10px; cursor:pointer; user-select:none; }
  .iconbtn i{ font-size:18px }
  .tabs{ display:flex; gap:10px; padding:10px 16px; overflow:auto hidden; background:var(--panel); border-bottom:1px solid var(--rule); }
  .tab{ padding:10px 14px; border-radius:10px; white-space:nowrap; text-decoration:none; color:var(--muted); border:1px solid transparent; flex:0 0 auto; font-weight:800; font-size:16px; }
  .tab.active{ color:var(--accent); background:var(--panel); border-color:var(--rule); }

  /* Content */
  .wrap{ padding:12px 16px 18px; max-width:1920px; margin:0 auto; }
  .panel{ background:var(--panel); border:1px solid var(--rule); border-radius:14px; overflow:hidden; box-shadow:var(--shadow); }

  /* Journey cards */
  .cards{ display:grid; grid-template-columns:1fr; }
  .card{ padding:18px; border-top:1px solid var(--rule); }
  .card:first-child{ border-top:none; }
  .row1{ display:flex; gap:10px; align-items:baseline; flex-wrap:wrap; }
  .dep,.arr,.dur,.chg{ font-variant-numeric:tabular-nums; font-weight:800; }
  .meta{ color:var(--muted); }
  .badge{ display:inline-flex; align-items:center; gap:8px; background:var(--chip); border:1px solid var(--rule); border-radius:10px; padding:6px 10px; font-weight:800; }
  .chips{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap; }
  .chip{ display:inline-flex; align-items:center; gap:10px; background:var(--chip); border:1px solid var(--rule); border-radius:10px; padding:8px 12px; font-weight:700; }
  .chip i{ opacity:.95 }
  .sub{ margin-top:6px; color:var(--muted); }

  /* Compact timeline */
  .timeline{ display:grid; grid-template-columns:24px 1fr auto; gap:8px 16px; margin-top:12px; padding:12px; border:1px dashed var(--rule); border-radius:12px; background:color-mix(in oklab, var(--chip) 65%, transparent); }
  .tl-icon{ text-align:center; color:var(--muted); }
  .tl-stop{ font-weight:700; }
  .tl-time,.tl-range{ color:var(--muted); font-variant-numeric:tabular-nums; white-space:nowrap; }
  .tl-wait{ margin-left:8px; color:var(--muted); font-size:13px; }

  @media (min-width:1100px){ .cards{ grid-template-columns:1fr 1fr; } .card{ min-height:92px; } }

  /* Departures table */
  table{ width:100%; border-collapse:collapse; }
  thead th{ text-align:left; background:var(--panel); position:sticky; top:0; z-index:5; padding:14px 16px; color:var(--muted); border-bottom:1px solid var(--rule); }
  thead th .hcell{ display:flex; align-items:center; gap:8px; }
  tbody td{ padding:14px 16px; border-bottom:1px solid var(--rule); vertical-align:middle; }
  .line{ font-weight:500; }
  .delta{ font-variant-numeric:tabular-nums; font-weight:800; }
  .delta.late{ color:#e74c3c; }
  .delta.early{ color:#27ae60; }
  .delta.ontime{ color:var(--muted);}
  .err{ color:#b40000; padding:14px 16px; }

  footer{ padding:10px 16px; color:var(--muted); font-size:13px; display:flex; gap:12px; align-items:center;}
  footer .dot{ opacity:.5 }
</style>
</head>
<body>
  <div class="hdr" role="banner">
    <div class="brand">Pendler Dashboard</div>
    <div class="spacer"></div>
    <button id="themeBtn" class="iconbtn" aria-label="Theme umschalten">
      <i class="fa-solid fa-sun" id="sunIcon"></i>
      <i class="fa-solid fa-moon" id="moonIcon" style="display:none"></i>
    </button>
  </div>

  <nav class="tabs" role="tablist" aria-label="Ansichten">
    <a href="#route-a"   class="tab active" role="tab" aria-selected="true"  id="tab-a">Gießen → Frankfurt(Main) Hbf</a>
    <a href="#route-b"   class="tab"        role="tab" aria-selected="false" id="tab-b">Frankfurt(Main) Hbf → Gießen</a>
    <a href="#abfahrten" class="tab"        role="tab" aria-selected="false" id="tab-c">Abfahrten (stadt­einwärts)</a>
    <a href="#homebound" class="tab"        role="tab" aria-selected="false" id="tab-d">Abfahrten (heimwärts)</a>
  </nav>

  <div class="wrap">
    <div class="panel" id="panel">
      <div id="view-route" hidden>
        <div id="cards" class="cards"><div class="card meta">Lade Verbindungen …</div></div>
      </div>

      <div id="view-abfahrten" hidden>
        <table>
          <thead>
            <tr>
              <th style="width:140px;"><div class="hcell"><i class="fa-solid fa-arrow-right-long"></i> Abfahrt</div></th>
              <th style="width:140px;"><div class="hcell"><i class="fa-regular fa-clock"></i> Plan</div></th>
              <th style="width:160px;"><div class="hcell"><i class="fa-solid fa-train"></i> Linie</div></th>
              <th><div class="hcell"><i class="fa-solid fa-location-dot"></i> Ziel</div></th>
              <th style="width:120px;"><div class="hcell"><i class="fa-solid fa-signs-post"></i> Steig</div></th>
              <th style="width:100px;"><div class="hcell"><i class="fa-solid fa-clock-rotate-left"></i> +-</div></th>
            </tr>
          </thead>
          <tbody id="rows"><tr><td colspan="6" style="padding:18px;color:var(--muted)">Lade Abfahrten …</td></tr></tbody>
        </table>
        <div class="err" id="depErr" hidden></div>
      </div>

      <div id="view-homebound" hidden>
        <table>
          <thead>
            <tr>
              <th style="width:140px;"><div class="hcell"><i class="fa-solid fa-arrow-right-long"></i> Abfahrt</div></th>
              <th style="width:140px;"><div class="hcell"><i class="fa-regular fa-clock"></i> Plan</div></th>
              <th style="width:160px;"><div class="hcell"><i class="fa-solid fa-train"></i> Linie</div></th>
              <th><div class="hcell"><i class="fa-solid fa-location-dot"></i> Ziel</div></th>
              <th style="width:120px;"><div class="hcell"><i class="fa-solid fa-signs-post"></i> Steig</div></th>
              <th style="width:100px;"><div class="hcell"><i class="fa-solid fa-clock-rotate-left"></i> +-</div></th>
            </tr>
          </thead>
          <tbody id="rows-home"><tr><td colspan="6" style="padding:18px;color:var(--muted)">Lade Abfahrten …</td></tr></tbody>
        </table>
        <div class="err" id="homeErr" hidden></div>
      </div>
    </div>
  </div>

  <footer>
    <span id="refreshInfo">Aktualisierung: —</span>
    <span class="dot">•</span>
    <span id="lastUpdated">Zuletzt: —</span>
  </footer>

<script>
/* ======== Auto-Theme mit Override ======== */
const THEME_KEY='pd-theme', OVERRIDE_KEY='pd-theme-override';
const mDark=window.matchMedia('(prefers-color-scheme: dark)');
function sysTheme(){return mDark.matches?'dark':'light';}
function applyTheme(mode){
  document.documentElement.setAttribute('data-theme',mode);
  sunIcon.style.display = (mode==='dark')?'none':'inline-block';
  moonIcon.style.display = (mode==='dark')?'inline-block':'none';
}
function initTheme(){
  const ovr=localStorage.getItem(OVERRIDE_KEY)==='1';
  if(ovr){ applyTheme(localStorage.getItem(THEME_KEY)||sysTheme()); }
  else{
    applyTheme(sysTheme());
    mDark.addEventListener('change',e=>applyTheme(e.matches?'dark':'light'));
  }
}
themeBtn.onclick=()=>{
  const cur=document.documentElement.getAttribute('data-theme')||sysTheme();
  const next=cur==='light'?'dark':'light';
  localStorage.setItem(OVERRIDE_KEY,'1');
  localStorage.setItem(THEME_KEY,next);
  applyTheme(next);
};
initTheme();

/* ======== Linienfarben (Flat-UI Defo inspiriert, deutlich unterscheidbar) ======== */
const FIXED_COLORS={
  'Bus 1':'#3498db','1':'#3498db',
  'Bus 17':'#e67e22','17':'#e67e22',
  'RB40':'#9b59b6','RB41':'#1abc9c',
  'RE30':'#f1c40f','S6':'#2ecc71',
  'ICE':'#2c3e50','IC':'#34495e'
};
const HUES=[168,145,204,282,48,28,6,210,320,260,100,36,14,190,230,75];
function hashLine(s){let h=0;for(let c of s)h=((h<<5)-h)+c.charCodeAt(0),h|=0;return Math.abs(h);}
function lineColor(name){
  if(!name) return '#7f8c8d';
  const k=name.trim();
  if(FIXED_COLORS[k]) return FIXED_COLORS[k];
  const n=k.replace(/\s+Richtung.*/i,'').trim();
  if(FIXED_COLORS[n]) return FIXED_COLORS[n];
  const hue=HUES[hashLine(k)%HUES.length];
  const dark=document.documentElement.getAttribute('data-theme')==='dark';
  const sat=80, light=dark?65:40;
  return `hsl(${hue} ${sat}% ${light}%)`;
}

/* ======== Rest der App: DB-API-Abruf, Rendering usw. ======== */
/* (hier bleibt alles wie in deiner vorherigen Version: API-Abfragen,
   Journey-/Departure-Renderer, Tabs, Timer etc.) */
</script>
</body>
</html>
